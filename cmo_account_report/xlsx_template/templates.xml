<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>
        <!-- Directory for Account XLSX Reports -->
        <record model="document.directory" id="dir_account_reports">
            <field name="name">Account Reports</field>
            <field name="parent_id" ref="document.dir_root"/>
            <field name="user_id" ref="base.user_root"/>
            <field name="ressource_id">0</field>
            <field name="group_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        # Input Tax Report
        <record id="xlsx_report_input_tax" model="ir.attachment">
            <field name="res_model">xlsx.report.input.tax</field>
            <field name="datas"></field>
            <field name="datas_fname">xlsx_report_input_tax.xlsx</field>
            <field name="name">Input Tax Report</field>
            <field name="parent_id" eval="ref('dir_account_reports')"/>
            <field name="description">
                {
                    '__EXPORT__': {
                        'Input Tax Report': {
                            '_HEAD_': {
                                'A2': 'calendar_period_id.name${value and "รายงานภาษีซื้อ (รวมใบเพิ่มหนี้ลดหนี้) นำยื่นในเดือน %s" % value or ""}',
                                'B4': '${env.user.company_id.partner_id.name}',
                                'B5': '${env.user.company_id.partner_id.name}',
                                'B6': 'company_id${value and " ".join([value.street, value.street2]) or ""}',
                                'G5': '${env.user.company_id.partner_id.taxbranch == "00000" and "[ X ]" or "[    ]"}',
                                'I5': '${env.user.company_id.partner_id.taxbranch != "00000" and "[ X ]" or "[    ]"}',
                                'J4': '${env.user.company_id.partner_id.vat}',
                                'J5': 'company_id.partner_id.taxbranch${value and "สาขาที่ %s" % value or "สาขาที่"}',
                            },
                            'results': {
                                'A10': 'invoice_date${value or ""}#{number_format=date}',
                                'B10': 'invoice_number${value or ""}',
                                'C10': 'tax_sequence_display${value or ""}',
                                'D10': 'partner_id${value and " ".join(list(filter(lambda l: l != False, [value.title.name, value.name]))) or ""}',
                                'E10': 'partner_id.vat${value or ""}',
                                'F10': 'partner_id.taxbranch${value and (value == "00000" and value) or ""}',
                                'G10': 'partner_id.taxbranch${value and (value != "00000" and value) or ""}',
                                'H10': 'base${value or 0}#{number_format=number}',
                                'I10': 'amount${value or 0}#{number_format=number}',
                                'J10': 'move_number${value or ""}',
                            },
                            '_TAIL_0': {
                                'G10': '${"รวม"}#{font=bold}',
                                'H10': '@{sum}#{font=bold;number_format=number}',
                                'I10': '@{sum}#{font=bold;number_format=number}',
                            }
                        }
                    }
                }
            </field>
        </record>

        # Output Tax Report
        <record id="xlsx_report_output_tax" model="ir.attachment">
            <field name="res_model">xlsx.report.output.tax</field>
            <field name="datas"></field>
            <field name="datas_fname">xlsx_report_output_tax.xlsx</field>
            <field name="name">Output Tax Report</field>
            <field name="parent_id" eval="ref('dir_account_reports')"/>
            <field name="description">
                {
                    '__EXPORT__': {
                        'Output Tax Report': {
                            '_HEAD_': {
                                'A2': 'calendar_period_id.name${value and "รายงานภาษีขาย (รวมใบเพิ่มหนี้ลดหนี้) นำยื่นในเดือน %s" % value or ""}',
                                'B6': 'company_id${value and " ".join([value.street, value.street2]) or ""}',
                                'C4': '${env.user.company_id.partner_id.name}',
                                'C5': '${env.user.company_id.partner_id.name}',
                                'G5': '${env.user.company_id.partner_id.taxbranch == "00000" and "[ X ]" or "[    ]"}',
                                'I5': '${env.user.company_id.partner_id.taxbranch != "00000" and "[ X ]" or "[    ]"}',
                                'J4': '${env.user.company_id.partner_id.vat}',
                                'J5': 'company_id.partner_id.taxbranch${value and "สาขาที่ %s" % value or "สาขาที่"}',
                            },
                            'results': {
                                'A10': 'cancel${value and "C" or ""}',
                                'B10': 'invoice_date${value or ""}#{number_format=date}',
                                'C10': 'invoice_number${value or ""}',
                                'D10': 'partner_id${value and " ".join(list(filter(lambda l: l != False, [value.title.name, value.name]))) or ""}',
                                'E10': 'partner_id.vat${value or ""}',
                                'F10': 'partner_id.taxbranch${value and (value == "00000" and value) or ""}',
                                'G10': 'partner_id.taxbranch${value and (value != "00000" and value) or ""}',
                                'H10': 'base${value or 0}#{number_format=number}',
                                'I10': 'amount${value or 0}#{number_format=number}',
                                'J10': 'move_number${value or ""}',
                            },
                            '_TAIL_0': {
                                'G10': '${"รวม"}#{font=bold}',
                                'H10': '@{sum}#{font=bold;number_format=number}',
                                'I10': '@{sum}#{font=bold;number_format=number}',
                            }
                        }
                    }
                }
            </field>
        </record>

        # Withholding Income Tax Report
        <record id="xlsx_report_withholding_income_tax" model="ir.attachment">
            <field name="res_model">xlsx.report.withholding.income.tax</field>
            <field name="datas"></field>
            <field name="datas_fname">xlsx_report_withholding_income_tax.xlsx</field>
            <field name="name">Withholding Income Tax</field>
            <field name="parent_id" eval="ref('dir_account_reports')"/>
            <field name="description">
                {
                    '__EXPORT__': {
                        'Withholding Income Tax': {
                            '_HEAD_': {
                                'A1': '${env.user.company_id.partner_id.name}',
                                'A2': 'income_tax_form${value == "pnd3" and "ใบแนบ ภ.ง.ด.3" or value == "pnd53" and "ใบแนบ ภ.ง.ด.53" or ""}',
                                'A3': 'calendar_period_id.name${value and "ประจำเดือน %s" % value or ""}',
                                'K2': '${env.user.company_id.partner_id.vat}',
                                'K3': '${env.user.company_id.partner_id.taxbranch}',
                            },
                            'results': {
                                'A6': "${'=ROW(?(A1))'}",
                                'B6': 'supplier_taxid${value or ""}#{number_format=text}',
                                'C6': 'supplier_name_th${value or ""}',
                                'D6': 'cert_id.supplier_partner_id${value and (value.street2 and " ".join([value.street, value.street2]) or value.street) or ""}',
                                'E6': 'date_value${value or ""}#{number_format=date}',
                                'F6': 'cert_line_id${value and value.wht_cert_income_desc or ""}',
                                'G6': "${'=IF(AND(?(H6)&lt;&gt;\"\",?(I6)&lt;&gt;\"\"),(I6/H6),\"\")'}#{number_format=percent}",
                                'H6': 'base_total${value or ""}#{number_format=number}',
                                'I6': 'tax_total${value or ""}#{number_format=number}',
                                'J6': 'tax_payer${value and (value == "withholding" and "1" or (value == "paid_one_time" and "3")) or ""}',
                                'K6': 'cert_id${value and value.number or ""}',
                            },
                            '_TAIL_0': {
                                'H6': '@{sum}#{font=bold;number_format=number}',
                                'I6': '@{sum}#{font=bold;number_format=number}',
                            }
                        }
                    }
                }
            </field>
        </record>

        # Withholding Income Tax Text Report
        <record id="xlsx_report_withholding_income_tax_text" model="ir.attachment">
            <field name="res_model">xlsx.report.withholding.income.tax</field>
            <field name="datas"></field>
            <field name="datas_fname">xlsx_report_withholding_income_tax_text.xlsx</field>
            <field name="name">Withholding Income Tax Text</field>
            <field name="parent_id" eval="ref('dir_account_reports')"/>
            <field name="description">
                {
                    '__EXPORT__': {
                        'Withholding Income Tax': {
                            'results': {
                                'B1': 'sequence${value or ""}',
                                'C1': 'supplier_taxid${value or ""}#{number_format=text}',
                                'E1': 'supplier_name_th${value or ""}',
                                'F1': 'cert_id.supplier_partner_id${value and (value.street2 and " ".join([value.street, value.street2]) or value.street) or ""}',
                                'G1': 'date_value${value and "%s%s%s" % (str(value).split("-")[0], str(value).split("-")[1], str(value)[8:10]) or ""}#{number_format=text}',
                                'H1': 'cert_line_id${value and value.wht_cert_income_desc or ""}',
                                'I1': '${"3.00 "}#{number_format=text}',
                                'J1': 'base_total${value or ""}#{number_format=number}',
                                'K1': 'tax_total${value or ""}#{number_format=number}',
                                'L1': 'tax_payer${value and (value == "withholding" and "1" or (value == "paid_one_time" and "3")) or ""}#{number_format=text}',
                                'AA1': '${" "}#{number_format=text}',
                            }
                        }
                    }
                }
            </field>
        </record>

        # Asset Report
        <record id="xlsx_report_asset" model="ir.attachment">
            <field name="res_model">xlsx.report.asset</field>
            <field name="datas"></field>
            <field name="datas_fname">xlsx_report_asset.xlsx</field>
            <field name="name">Asset Report</field>
            <field name="parent_id" eval="ref('dir_account_reports')"/>
            <field name="description">
                {
                    '__EXPORT__': {
                        'Asset Report': {
                            '_HEAD_': {
                                'A2': '${env.user.company_id.partner_id.name}',
                                'A4': 'date_filter${value or ""}',
                            },
                            'results': {
                                'A8': "${'=IF(?(S8)=?(S7),\"\",?(S8)'}#{font=bold}",
                                'B8': 'asset_id.number${value or ""}',
                                'C8': 'asset_id.name${value or ""}',
                                'D8': 'asset_id.purchase_date${value or ""}#{number_format=datestamp}',
                                'E8': 'asset_id.date_start${value or ""}#{number_format=datestamp}',
                                'F8': 'asset_id.purchase_value${value or 0}#{number_format=number}',
                                'G8': "${'=?(L8)+?(J8)'}#{number_format=number}",
                                'H8': 'method_number${value or 0}#{number_format=number}',
                                'I8': 'asset_id.salvage_value${value or 0}#{number_format=number}',
                                'J8': 'depreciation${value or 0}#{number_format=number}',
                                'K8': 'accumulated${value or 0}#{number_format=number}',
                                'L8': "${'=?(F8)-?(I8)-?(K8)'}#{number_format=number}",
                                'M8': 'asset_id.operating_unit_id${value and value.name or ""}',
                                'N8': 'asset_id.code${value or ""}',
                                'O8': 'asset_id.note${value or ""}',
                                # Hide Asset name
                                'S8': 'name_asset${value or ""}',
                            },
                            '_GROUPBY_results["name_asset"]': {  # groupby
                                'F8': '@{sum}#{font=bold;number_format=number}',
                                'G8': '@{sum}#{font=bold;number_format=number}',
                                'J8': '@{sum}#{font=bold;number_format=number}',
                                'K8': '@{sum}#{font=bold;number_format=number}',
                                'L8': '@{sum}#{font=bold;number_format=number}',
                            },
                        },
                    }
                }
            </field>
        </record>

    </data>
</openerp>
